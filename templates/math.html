<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MATH BLITZ â€” NEONarcade</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;600;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
<style>
  :root {
    --neon-green: #39ff14;
    --neon-cyan: #00f5ff;
    --neon-pink: #ff006e;
    --neon-yellow: #ffbe0b;
    --neon-orange: #ff8c00;
    --neon-purple: #bf5fff;
    --bg: #020408;
    --card: #080d14;
    --border: #0f1e2e;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: #fff;
    font-family: 'Rajdhani', sans-serif;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    overflow-x: hidden;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      linear-gradient(rgba(57,255,20,0.025) 1px, transparent 1px),
      linear-gradient(90deg, rgba(57,255,20,0.025) 1px, transparent 1px);
    background-size: 35px 35px;
    pointer-events: none;
    z-index: 0;
  }

  /* Scanline */
  body::after {
    content: '';
    position: fixed;
    inset: 0;
    background: repeating-linear-gradient(
      0deg,
      transparent,
      transparent 2px,
      rgba(0,0,0,0.08) 2px,
      rgba(0,0,0,0.08) 4px
    );
    pointer-events: none;
    z-index: 1000;
  }

  .topbar {
    width: 100%;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.2rem 2.5rem;
    border-bottom: 1px solid var(--border);
    position: relative;
    z-index: 10;
  }

  .back-btn {
    color: var(--neon-green);
    text-decoration: none;
    font-family: 'Orbitron', monospace;
    font-size: 0.65rem;
    letter-spacing: 3px;
    border: 1px solid rgba(57,255,20,0.3);
    padding: 0.45rem 1rem;
    transition: all 0.2s;
  }
  .back-btn:hover { background: rgba(57,255,20,0.08); }

  .logo {
    font-family: 'Orbitron', monospace;
    font-size: 1.1rem;
    font-weight: 900;
    letter-spacing: 4px;
    color: var(--neon-green);
    text-shadow: 0 0 15px var(--neon-green);
  }
  .logo span { color: rgba(255,255,255,0.3); }

  /* â”€â”€ LEVEL SELECT SCREEN â”€â”€ */
  #levelSelectScreen {
    width: 100%;
    max-width: 900px;
    padding: 2rem 2rem 4rem;
    position: relative;
    z-index: 5;
  }

  .screen-title {
    font-family: 'Orbitron', monospace;
    font-size: clamp(1.8rem, 4vw, 2.8rem);
    font-weight: 900;
    letter-spacing: 6px;
    text-align: center;
    margin-bottom: 0.5rem;
    background: linear-gradient(90deg, var(--neon-green), var(--neon-cyan));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    text-shadow: none;
  }

  .screen-sub {
    text-align: center;
    color: rgba(255,255,255,0.3);
    letter-spacing: 3px;
    font-size: 0.85rem;
    margin-bottom: 2.5rem;
    text-transform: uppercase;
  }

  /* Tier labels */
  .tier-label {
    font-family: 'Orbitron', monospace;
    font-size: 0.65rem;
    letter-spacing: 4px;
    text-transform: uppercase;
    padding: 0.3rem 1rem;
    margin-bottom: 0.8rem;
    display: inline-block;
    border-left: 3px solid;
  }

  .tier-section { margin-bottom: 1.5rem; }

  .tier-beginner .tier-label { color: var(--neon-green); border-color: var(--neon-green); }
  .tier-easy .tier-label { color: var(--neon-cyan); border-color: var(--neon-cyan); }
  .tier-medium .tier-label { color: var(--neon-yellow); border-color: var(--neon-yellow); }
  .tier-hard .tier-label { color: var(--neon-orange); border-color: var(--neon-orange); }
  .tier-expert .tier-label { color: var(--neon-pink); border-color: var(--neon-pink); }
  .tier-master .tier-label { color: var(--neon-purple); border-color: var(--neon-purple); }
  .tier-legendary .tier-label { color: #fff; border-color: #fff; }

  .levels-row {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 0.5rem;
  }

  .lvl-btn {
    width: 46px;
    height: 46px;
    background: var(--card);
    border: 1px solid var(--border);
    color: rgba(255,255,255,0.4);
    font-family: 'Orbitron', monospace;
    font-size: 0.65rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.15s;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .lvl-btn:hover { transform: scale(1.1); z-index: 2; }

  .lvl-btn.tier-beginner-btn:hover { border-color: var(--neon-green); color: var(--neon-green); box-shadow: 0 0 12px rgba(57,255,20,0.4); }
  .lvl-btn.tier-easy-btn:hover { border-color: var(--neon-cyan); color: var(--neon-cyan); box-shadow: 0 0 12px rgba(0,245,255,0.4); }
  .lvl-btn.tier-medium-btn:hover { border-color: var(--neon-yellow); color: var(--neon-yellow); box-shadow: 0 0 12px rgba(255,190,11,0.4); }
  .lvl-btn.tier-hard-btn:hover { border-color: var(--neon-orange); color: var(--neon-orange); box-shadow: 0 0 12px rgba(255,140,0,0.4); }
  .lvl-btn.tier-expert-btn:hover { border-color: var(--neon-pink); color: var(--neon-pink); box-shadow: 0 0 12px rgba(255,0,110,0.4); }
  .lvl-btn.tier-master-btn:hover { border-color: var(--neon-purple); color: var(--neon-purple); box-shadow: 0 0 12px rgba(191,95,255,0.4); }
  .lvl-btn.tier-legendary-btn:hover { border-color: #fff; color: #fff; box-shadow: 0 0 12px rgba(255,255,255,0.5); }

  .lvl-btn.completed {
    border-color: var(--neon-green) !important;
    background: rgba(57,255,20,0.07);
    color: var(--neon-green) !important;
  }
  .lvl-btn.completed::after {
    content: 'âœ“';
    position: absolute;
    top: 1px; right: 3px;
    font-size: 8px;
    color: var(--neon-green);
    font-family: sans-serif;
  }

  /* â”€â”€ GAME SCREEN â”€â”€ */
  #gameScreen {
    display: none;
    width: 100%;
    max-width: 700px;
    padding: 1.5rem 2rem 3rem;
    position: relative;
    z-index: 5;
    flex-direction: column;
    align-items: center;
  }

  .game-header {
    width: 100%;
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
  }

  .level-badge {
    font-family: 'Orbitron', monospace;
    font-size: 0.7rem;
    letter-spacing: 3px;
    padding: 0.4rem 1rem;
    border: 1px solid var(--accent, var(--neon-green));
    color: var(--accent, var(--neon-green));
    text-shadow: 0 0 8px var(--accent, var(--neon-green));
    box-shadow: 0 0 8px rgba(57,255,20,0.15);
  }

  .game-stats {
    display: flex;
    gap: 2rem;
  }

  .stat-pill {
    text-align: center;
  }
  .stat-val {
    font-family: 'Orbitron', monospace;
    font-size: 1.3rem;
    font-weight: 900;
    color: var(--accent, var(--neon-green));
    text-shadow: 0 0 10px var(--accent, var(--neon-green));
    display: block;
  }
  .stat-lbl {
    font-size: 0.6rem;
    letter-spacing: 2px;
    color: rgba(255,255,255,0.25);
    text-transform: uppercase;
  }

  /* Progress bar */
  .progress-wrap {
    width: 100%;
    height: 6px;
    background: rgba(255,255,255,0.05);
    margin-bottom: 1.5rem;
    position: relative;
    border-radius: 0;
  }

  .progress-bar {
    height: 100%;
    background: var(--accent, var(--neon-green));
    box-shadow: 0 0 8px var(--accent, var(--neon-green));
    transition: width 0.3s ease;
  }

  .progress-text {
    position: absolute;
    right: 0;
    top: -18px;
    font-size: 0.65rem;
    color: rgba(255,255,255,0.3);
    letter-spacing: 1px;
    font-family: 'Orbitron', monospace;
  }

  /* Timer ring */
  .timer-ring-wrap {
    margin-bottom: 1.5rem;
    position: relative;
    width: 90px;
    height: 90px;
  }

  .timer-ring-wrap svg { transform: rotate(-90deg); }

  .timer-num {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Orbitron', monospace;
    font-size: 1.4rem;
    font-weight: 900;
    color: var(--accent, var(--neon-green));
    text-shadow: 0 0 10px var(--accent, var(--neon-green));
  }

  /* Question display */
  .question-type-tag {
    font-size: 0.65rem;
    letter-spacing: 3px;
    color: rgba(255,255,255,0.25);
    text-transform: uppercase;
    margin-bottom: 0.8rem;
    text-align: center;
  }

  .question-box {
    background: var(--card);
    border: 1px solid var(--border);
    border-top: 2px solid var(--accent, var(--neon-green));
    width: 100%;
    padding: 2rem;
    text-align: center;
    margin-bottom: 1.5rem;
    position: relative;
    overflow: hidden;
  }

  .question-box::before {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(ellipse at center top, rgba(57,255,20,0.04) 0%, transparent 70%);
  }

  .question-text {
    font-family: 'Share Tech Mono', monospace;
    font-size: clamp(1.6rem, 5vw, 2.8rem);
    color: #fff;
    line-height: 1.3;
    letter-spacing: 2px;
    position: relative;
    z-index: 1;
    word-break: break-word;
  }

  .question-hint {
    margin-top: 0.8rem;
    font-size: 0.8rem;
    color: rgba(255,255,255,0.25);
    letter-spacing: 1px;
    font-style: italic;
    position: relative;
    z-index: 1;
  }

  /* Answer options (MCQ) */
  .options-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    width: 100%;
    margin-bottom: 1.5rem;
  }

  .option-btn {
    background: var(--card);
    border: 1px solid var(--border);
    color: rgba(255,255,255,0.7);
    font-family: 'Share Tech Mono', monospace;
    font-size: 1.2rem;
    padding: 1rem;
    cursor: pointer;
    transition: all 0.15s;
    text-align: center;
    letter-spacing: 1px;
  }

  .option-btn:hover:not(:disabled) {
    border-color: var(--accent, var(--neon-green));
    color: var(--accent, var(--neon-green));
    background: rgba(57,255,20,0.05);
    transform: scale(1.02);
  }

  .option-btn.correct {
    border-color: var(--neon-green) !important;
    background: rgba(57,255,20,0.15) !important;
    color: var(--neon-green) !important;
    box-shadow: 0 0 20px rgba(57,255,20,0.3);
  }

  .option-btn.wrong {
    border-color: var(--neon-pink) !important;
    background: rgba(255,0,110,0.12) !important;
    color: var(--neon-pink) !important;
  }

  /* Type-in answer */
  .input-row {
    display: flex;
    gap: 10px;
    width: 100%;
    margin-bottom: 1.5rem;
  }

  .answer-input {
    flex: 1;
    background: var(--card);
    border: 1px solid var(--border);
    border-top: 2px solid var(--accent, var(--neon-green));
    color: #fff;
    font-family: 'Share Tech Mono', monospace;
    font-size: 1.6rem;
    padding: 0.8rem 1.2rem;
    outline: none;
    text-align: center;
    letter-spacing: 3px;
    transition: border-color 0.2s;
  }

  .answer-input:focus { border-color: var(--accent, var(--neon-green)); box-shadow: 0 0 15px rgba(57,255,20,0.15); }
  .answer-input.shake { animation: shake 0.4s ease; }
  .answer-input.correct-flash { border-color: var(--neon-green); background: rgba(57,255,20,0.08); }
  .answer-input.wrong-flash { border-color: var(--neon-pink); background: rgba(255,0,110,0.08); }

  @keyframes shake {
    0%,100%{transform:translateX(0)}
    20%{transform:translateX(-8px)}
    40%{transform:translateX(8px)}
    60%{transform:translateX(-5px)}
    80%{transform:translateX(5px)}
  }

  .submit-btn {
    font-family: 'Orbitron', monospace;
    font-size: 0.75rem;
    font-weight: 700;
    letter-spacing: 2px;
    color: #000;
    background: var(--accent, var(--neon-green));
    border: none;
    padding: 0 1.8rem;
    cursor: pointer;
    transition: all 0.15s;
    box-shadow: 0 0 15px rgba(57,255,20,0.4);
    text-transform: uppercase;
  }

  .submit-btn:hover { transform: scale(1.05); box-shadow: 0 0 25px rgba(57,255,20,0.6); }

  /* Feedback flash */
  .feedback {
    font-family: 'Orbitron', monospace;
    font-size: 1rem;
    letter-spacing: 3px;
    height: 28px;
    text-align: center;
    margin-bottom: 1rem;
    transition: opacity 0.2s;
    text-transform: uppercase;
  }

  .feedback.correct-fb { color: var(--neon-green); text-shadow: 0 0 15px var(--neon-green); }
  .feedback.wrong-fb { color: var(--neon-pink); text-shadow: 0 0 15px var(--neon-pink); }

  /* Streak bar */
  .streak-display {
    font-family: 'Orbitron', monospace;
    font-size: 0.7rem;
    letter-spacing: 2px;
    color: rgba(255,255,255,0.25);
    text-align: center;
    margin-bottom: 1rem;
  }

  .streak-display.hot { color: var(--neon-orange); text-shadow: 0 0 8px var(--neon-orange); animation: pulse 0.5s ease infinite alternate; }

  @keyframes pulse { from { opacity: 0.7; } to { opacity: 1; } }

  /* Level complete overlay */
  #levelComplete {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(2,4,8,0.95);
    z-index: 200;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  .complete-card {
    background: var(--card);
    border: 1px solid var(--accent, var(--neon-green));
    box-shadow: 0 0 60px rgba(57,255,20,0.15);
    padding: 3rem 4rem;
    text-align: center;
    max-width: 480px;
    width: 90%;
  }

  .complete-icon { font-size: 4rem; margin-bottom: 1rem; }

  .complete-title {
    font-family: 'Orbitron', monospace;
    font-size: 1.8rem;
    font-weight: 900;
    letter-spacing: 4px;
    margin-bottom: 0.5rem;
    color: var(--accent, var(--neon-green));
    text-shadow: 0 0 20px var(--accent, var(--neon-green));
  }

  .complete-stats {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 1rem;
    margin: 1.5rem 0;
    padding: 1.2rem;
    border: 1px solid var(--border);
    background: rgba(0,0,0,0.3);
  }

  .c-stat-val {
    font-family: 'Orbitron', monospace;
    font-size: 1.5rem;
    font-weight: 900;
    color: var(--accent, var(--neon-green));
    display: block;
  }

  .c-stat-lbl {
    font-size: 0.65rem;
    letter-spacing: 2px;
    color: rgba(255,255,255,0.3);
    text-transform: uppercase;
  }

  .complete-btns { display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap; }

  .c-btn {
    font-family: 'Orbitron', monospace;
    font-size: 0.7rem;
    letter-spacing: 2px;
    padding: 0.7rem 1.5rem;
    cursor: pointer;
    border: 1px solid;
    background: transparent;
    transition: all 0.2s;
    text-transform: uppercase;
  }

  .c-btn-primary { color: #000; background: var(--accent, var(--neon-green)); border-color: var(--accent, var(--neon-green)); box-shadow: 0 0 15px rgba(57,255,20,0.4); }
  .c-btn-primary:hover { box-shadow: 0 0 25px rgba(57,255,20,0.6); transform: scale(1.04); }
  .c-btn-secondary { color: rgba(255,255,255,0.5); border-color: var(--border); }
  .c-btn-secondary:hover { border-color: rgba(255,255,255,0.3); color: #fff; }

  /* Game Over overlay */
  #gameOver {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(2,4,8,0.95);
    z-index: 200;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  /* Stars */
  .stars { display: flex; gap: 0.5rem; justify-content: center; margin-bottom: 1rem; font-size: 2rem; }

  /* Particles */
  .particle {
    position: fixed;
    pointer-events: none;
    z-index: 300;
    font-size: 1.5rem;
    animation: pop-particle 0.8s ease forwards;
    top: 50%;
    left: 50%;
  }

  @keyframes pop-particle {
    0% { transform: translate(0,0) scale(0); opacity: 1; }
    100% { transform: translate(var(--dx), var(--dy)) scale(1.5); opacity: 0; }
  }

  /* Scrollbar */
  ::-webkit-scrollbar { width: 4px; }
  ::-webkit-scrollbar-track { background: var(--bg); }
  ::-webkit-scrollbar-thumb { background: var(--neon-green); }
</style>
</head>
<body>

<div class="topbar">
  <a href="/" class="back-btn">â† ARCADE</a>
  <div class="logo">MATH<span> BLITZ</span></div>
  <div style="font-family:'Orbitron',monospace;font-size:0.65rem;letter-spacing:2px;color:rgba(255,255,255,0.2);">100 LEVELS</div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     LEVEL SELECT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="levelSelectScreen">
  <div class="screen-title">SELECT LEVEL</div>
  <div class="screen-sub">100 challenges Â· 7 tiers Â· unlimited madness</div>

  <!-- TIER 1: Beginner 1-10 -->
  <div class="tier-section tier-beginner">
    <div class="tier-label">â¬¡ TIER I â€” RECRUIT (1â€“10) Â· Addition &amp; Subtraction</div>
    <div class="levels-row" id="tier1"></div>
  </div>

  <!-- TIER 2: Easy 11-20 -->
  <div class="tier-section tier-easy">
    <div class="tier-label">â¬¡ TIER II â€” SCOUT (11â€“20) Â· Multiplication &amp; Division</div>
    <div class="levels-row" id="tier2"></div>
  </div>

  <!-- TIER 3: Medium 21-35 -->
  <div class="tier-section tier-medium">
    <div class="tier-label">â¬¡ TIER III â€” OPERATIVE (21â€“35) Â· Mixed Operations &amp; Fractions</div>
    <div class="levels-row" id="tier3"></div>
  </div>

  <!-- TIER 4: Hard 36-55 -->
  <div class="tier-section tier-hard">
    <div class="tier-label">â¬¡ TIER IV â€” VETERAN (36â€“55) Â· Powers, Roots &amp; Algebra</div>
    <div class="levels-row" id="tier4"></div>
  </div>

  <!-- TIER 5: Expert 56-70 -->
  <div class="tier-section tier-expert">
    <div class="tier-label">â¬¡ TIER V â€” SPECIALIST (56â€“70) Â· Geometry, Percentages &amp; Word Problems</div>
    <div class="levels-row" id="tier5"></div>
  </div>

  <!-- TIER 6: Master 71-85 -->
  <div class="tier-section tier-master">
    <div class="tier-label">â¬¡ TIER VI â€” MASTER (71â€“85) Â· Sequences, Primes &amp; Logic</div>
    <div class="levels-row" id="tier6"></div>
  </div>

  <!-- TIER 7: Legendary 86-100 -->
  <div class="tier-section tier-legendary">
    <div class="tier-label">â¬¡ TIER VII â€” LEGENDARY (86â€“100) Â· Multi-step &amp; Chaos Math</div>
    <div class="levels-row" id="tier7"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     GAME SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="gameScreen">

  <div class="game-header">
    <div class="level-badge" id="levelBadge">LVL 1</div>
    <div class="game-stats">
      <div class="stat-pill">
        <span class="stat-val" id="scoreVal">0</span>
        <span class="stat-lbl">Score</span>
      </div>
      <div class="stat-pill">
        <span class="stat-val" id="livesVal">â™¥â™¥â™¥</span>
        <span class="stat-lbl">Lives</span>
      </div>
      <div class="stat-pill">
        <span class="stat-val" id="questionNum">0/10</span>
        <span class="stat-lbl">Progress</span>
      </div>
    </div>
  </div>

  <div class="progress-wrap">
    <span class="progress-text" id="progressText">0%</span>
    <div class="progress-bar" id="progressBar" style="width:0%"></div>
  </div>

  <div class="streak-display" id="streakDisplay">STREAK: 0</div>

  <div class="timer-ring-wrap">
    <svg width="90" height="90" viewBox="0 0 90 90">
      <circle cx="45" cy="45" r="38" fill="none" stroke="rgba(255,255,255,0.06)" stroke-width="6"/>
      <circle id="timerCircle" cx="45" cy="45" r="38" fill="none" stroke="#39ff14" stroke-width="6"
        stroke-dasharray="238.76" stroke-dashoffset="0" stroke-linecap="round"
        style="transition:stroke-dashoffset 0.1s linear;"/>
    </svg>
    <div class="timer-num" id="timerNum">30</div>
  </div>

  <div class="question-type-tag" id="questionTypeTag">ADDITION</div>

  <div class="question-box">
    <div class="question-text" id="questionText">Loading...</div>
    <div class="question-hint" id="questionHint"></div>
  </div>

  <div class="feedback" id="feedback"></div>

  <!-- MCQ options (shown for some levels) -->
  <div class="options-grid" id="optionsGrid" style="display:none"></div>

  <!-- Type-in input (shown for most levels) -->
  <div class="input-row" id="inputRow">
    <input class="answer-input" id="answerInput" type="text" inputmode="decimal" placeholder="???" autocomplete="off" />
    <button class="submit-btn" id="submitBtn">OK</button>
  </div>

</div>

<!-- Level Complete -->
<div id="levelComplete">
  <div class="complete-card">
    <div class="complete-icon">ğŸ†</div>
    <div class="complete-title" id="completeTitle">LEVEL CLEAR!</div>
    <div style="color:rgba(255,255,255,0.4);font-size:0.85rem;margin-bottom:0.5rem;" id="completeMsg">Excellent work!</div>
    <div class="stars" id="completeStars">â­â­â­</div>
    <div class="complete-stats">
      <div>
        <span class="c-stat-val" id="cScore">0</span>
        <span class="c-stat-lbl">Score</span>
      </div>
      <div>
        <span class="c-stat-val" id="cAccuracy">0%</span>
        <span class="c-stat-lbl">Accuracy</span>
      </div>
      <div>
        <span class="c-stat-val" id="cBestStreak">0</span>
        <span class="c-stat-lbl">Best Streak</span>
      </div>
    </div>
    <div class="complete-btns">
      <button class="c-btn c-btn-secondary" onclick="exitToMenu()">MENU</button>
      <button class="c-btn c-btn-primary" id="nextLevelBtn" onclick="nextLevel()">NEXT LEVEL â†’</button>
    </div>
  </div>
</div>

<!-- Game Over -->
<div id="gameOver">
  <div class="complete-card" style="border-color:var(--neon-pink);box-shadow:0 0 60px rgba(255,0,110,0.15)">
    <div class="complete-icon">ğŸ’€</div>
    <div class="complete-title" style="color:var(--neon-pink);text-shadow:0 0 20px var(--neon-pink)">GAME OVER</div>
    <div style="color:rgba(255,255,255,0.4);font-size:0.85rem;margin-bottom:1rem;" id="gameOverMsg">You ran out of lives!</div>
    <div class="complete-stats">
      <div>
        <span class="c-stat-val" style="color:var(--neon-pink);" id="goScore">0</span>
        <span class="c-stat-lbl">Score</span>
      </div>
      <div>
        <span class="c-stat-val" style="color:var(--neon-pink);" id="goAccuracy">0%</span>
        <span class="c-stat-lbl">Accuracy</span>
      </div>
      <div>
        <span class="c-stat-val" style="color:var(--neon-pink);" id="goStreak">0</span>
        <span class="c-stat-lbl">Best Streak</span>
      </div>
    </div>
    <div class="complete-btns">
      <button class="c-btn c-btn-secondary" onclick="exitToMenu()">MENU</button>
      <button class="c-btn" style="color:#000;background:var(--neon-pink);border-color:var(--neon-pink);box-shadow:0 0 15px rgba(255,0,110,0.4);" onclick="retryLevel()">RETRY</button>
    </div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TIER COLORS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const TIER_INFO = [
  { tier:'beginner', cls:'tier-beginner-btn', color:'#39ff14', levels:[1,10] },
  { tier:'easy',     cls:'tier-easy-btn',     color:'#00f5ff', levels:[11,20] },
  { tier:'medium',   cls:'tier-medium-btn',   color:'#ffbe0b', levels:[21,35] },
  { tier:'hard',     cls:'tier-hard-btn',     color:'#ff8c00', levels:[36,55] },
  { tier:'expert',   cls:'tier-expert-btn',   color:'#ff006e', levels:[56,70] },
  { tier:'master',   cls:'tier-master-btn',   color:'#bf5fff', levels:[71,85] },
  { tier:'legendary',cls:'tier-legendary-btn',color:'#ffffff', levels:[86,100] },
];

const tierContainerMap = {1:'tier1',2:'tier2',3:'tier3',4:'tier4',5:'tier5',6:'tier6',7:'tier7'};
let completed = JSON.parse(localStorage.getItem('mathBlitzCompleted')||'{}');

function getTierIndex(lvl) {
  for (let i=0;i<TIER_INFO.length;i++) {
    const [min,max] = TIER_INFO[i].levels;
    if (lvl>=min && lvl<=max) return i;
  }
  return 0;
}

function buildLevelSelect() {
  TIER_INFO.forEach((t, ti) => {
    const container = document.getElementById(tierContainerMap[ti+1]);
    for (let lvl=t.levels[0]; lvl<=t.levels[1]; lvl++) {
      const btn = document.createElement('button');
      btn.className = `lvl-btn ${t.cls}`;
      btn.textContent = lvl;
      if (completed[lvl]) btn.classList.add('completed');
      btn.onclick = () => startLevel(lvl);
      container.appendChild(btn);
    }
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// QUESTION GENERATION â€” 100 UNIQUE LEVEL CONFIGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function rand(min, max) { return Math.floor(Math.random()*(max-min+1))+min; }
function randF(min, max, dp=1) { return parseFloat((Math.random()*(max-min)+min).toFixed(dp)); }
function choice(arr) { return arr[Math.floor(Math.random()*arr.length)]; }
function gcd(a,b){return b===0?a:gcd(b,a%b);}
function isPrime(n){if(n<2)return false;for(let i=2;i<=Math.sqrt(n);i++)if(n%i===0)return false;return true;}
function primes(max){let r=[];for(let i=2;i<=max;i++)if(isPrime(i))r.push(i);return r;}
function nthPrime(n){let count=0,i=1;while(count<n){i++;if(isPrime(i))count++;}return i;}

// Each level returns {question, answer, hint, type, time, useMCQ}
function generateQuestion(level) {
  const L = level;
  let q='', ans=0, hint='', type='', time=600, mcq=false;

  // TIER I: 1-10 â€” Basic Addition & Subtraction
  if (L===1) {
    type='ADDITION';time=25;
    let a=rand(1,10),b=rand(1,10); q=`${a} + ${b} = ?`; ans=a+b;
  } else if (L===2) {
    type='SUBTRACTION';time=25;
    let a=rand(5,20),b=rand(1,a); q=`${a} âˆ’ ${b} = ?`; ans=a-b;
  } else if (L===3) {
    type='ADDITION';time=22;
    let a=rand(10,50),b=rand(10,50); q=`${a} + ${b} = ?`; ans=a+b;
  } else if (L===4) {
    type='SUBTRACTION';time=22;
    let a=rand(20,100),b=rand(1,a); q=`${a} âˆ’ ${b} = ?`; ans=a-b;
  } else if (L===5) {
    type='ADDITION';time=20;
    let a=rand(50,200),b=rand(50,200); q=`${a} + ${b} = ?`; ans=a+b;
  } else if (L===6) {
    type='MIXED Â± ';time=20;
    let a=rand(10,50),b=rand(1,30),c=rand(1,20);
    q=`${a} + ${b} âˆ’ ${c} = ?`; ans=a+b-c;
  } else if (L===7) {
    type='SUBTRACTION';time=20;
    let a=rand(100,500),b=rand(10,100); q=`${a} âˆ’ ${b} = ?`; ans=a-b;
  } else if (L===8) {
    type='ADDITION';time=18;
    let a=rand(100,999),b=rand(100,999); q=`${a} + ${b} = ?`; ans=a+b;
  } else if (L===9) {
    type='CHAIN ADD';time=18;
    let a=rand(5,20),b=rand(5,20),c=rand(5,20),d=rand(5,20);
    q=`${a} + ${b} + ${c} + ${d} = ?`; ans=a+b+c+d;
    hint='Add step by step';
  } else if (L===10) {
    type='FILL IN Â±';time=18;mcq=true;
    let a=rand(10,50),b=rand(10,50),ans_r=a+b;
    q=`${a} + ___ = ${ans_r}`; ans=b;
    hint='What is the missing number?';

  // TIER II: 11-20 â€” Multiplication & Division
  } else if (L===11) {
    type='MULTIPLICATION';time=25;
    let a=rand(2,9),b=rand(2,9); q=`${a} Ã— ${b} = ?`; ans=a*b;
  } else if (L===12) {
    type='DIVISION';time=25;
    let b=rand(2,9),q2=rand(2,9); q=`${b*q2} Ã· ${b} = ?`; ans=q2;
  } else if (L===13) {
    type='TIMES TABLES';time=20;mcq=true;
    let a=rand(6,12),b=rand(6,12); q=`${a} Ã— ${b} = ?`; ans=a*b;
  } else if (L===14) {
    type='DIVISION';time=22;
    let a=rand(2,12),b=rand(10,20); q=`${a*b} Ã· ${a} = ?`; ans=b;
  } else if (L===15) {
    type='Ã—Ã· MIXED';time=20;
    let a=rand(3,9),b=rand(3,9),c=rand(2,5); q=`${a} Ã— ${b} Ã· ${c} = ?`;
    let r=a*b/c; if(!Number.isInteger(r)){a=c*rand(2,5);q=`${a} Ã— ${b} Ã· ${c} = ?`;r=a*b/c;} ans=r;
  } else if (L===16) {
    type='MULTIPLICATION';time=18;
    let a=rand(11,25),b=rand(2,9); q=`${a} Ã— ${b} = ?`; ans=a*b;
  } else if (L===17) {
    type='3-DIGIT Ã— 1';time=18;
    let a=rand(100,300),b=rand(2,9); q=`${a} Ã— ${b} = ?`; ans=a*b;
  } else if (L===18) {
    type='REMAINDERS';time=20;mcq=true;
    let a=rand(2,9),b=rand(10,50); let r=b%a; q=`${b} Ã· ${a} â€” remainder?`; ans=r;
    hint='What is left over?';
  } else if (L===19) {
    type='FACTORS';time=22;mcq=true;
    let n=rand(12,60); q=`How many factors does ${n} have?`;
    let count=0; for(let i=1;i<=n;i++) if(n%i===0) count++;
    ans=count; hint='Count all divisors';
  } else if (L===20) {
    type='2Ã—2 MULTIPLY';time=20;
    let a=rand(12,30),b=rand(12,30); q=`${a} Ã— ${b} = ?`; ans=a*b;

  // TIER III: 21-35 â€” Mixed Ops & Fractions
  } else if (L===21) {
    type='ORDER OF OPS';time=22;
    let a=rand(2,9),b=rand(2,9),c=rand(1,9); q=`${a} + ${b} Ã— ${c} = ?`; ans=a+b*c;
    hint='Multiply before adding (BODMAS)';
  } else if (L===22) {
    type='ORDER OF OPS';time=22;
    let a=rand(2,10),b=rand(2,10),c=rand(1,5); q=`(${a} + ${b}) Ã— ${c} = ?`; ans=(a+b)*c;
  } else if (L===23) {
    type='FRACTIONS ADD';time=25;mcq=true;
    let d=choice([2,3,4,5,6,8,10]),n1=rand(1,d-1),n2=rand(1,d-1);
    let num=n1+n2,den=d, g=gcd(num,den); num/=g;den/=g;
    q=`${n1}/${d} + ${n2}/${d} = ?`;
    ans=`${num}/${den}`;
    hint='Same denominator â€” add numerators';
  } else if (L===24) {
    type='FRACTION MULT';time=25;mcq=true;
    let a1=rand(1,5),b1=rand(2,6),a2=rand(1,5),b2=rand(2,6);
    let num=a1*a2,den=b1*b2,g=gcd(num,den); num/=g;den/=g;
    q=`${a1}/${b1} Ã— ${a2}/${b2} = ?`; ans=`${num}/${den}`;
    hint='Multiply top Ã— top, bottom Ã— bottom';
  } else if (L===25) {
    type='BODMAS';time=22;
    let a=rand(2,8),b=rand(2,6),c=rand(1,6),d=rand(1,4);
    q=`${a} Ã— ${b} + ${c} Ã— ${d} = ?`; ans=a*b+c*d;
  } else if (L===26) {
    type='BRACKETS';time=20;
    let a=rand(10,30),b=rand(5,20),c=rand(2,6); q=`(${a} âˆ’ ${b}) Ã— ${c} = ?`; ans=(a-b)*c;
  } else if (L===27) {
    type='MIXED FRACS';time=25;mcq=true;
    let w=rand(1,4),n=rand(1,3),d=choice([4,5,6,8]);
    q=`${w} + ${n}/${d} = ?`; ans=`${w*d+n}/${d}`;
    hint='Convert to improper fraction';
  } else if (L===28) {
    type='LCM';time=25;mcq=true;
    let a=choice([2,3,4,5,6]),b=choice([3,4,5,6,8]);
    let lcm_ab=a*b/gcd(a,b); q=`LCM of ${a} and ${b}?`; ans=lcm_ab;
    hint='Lowest Common Multiple';
  } else if (L===29) {
    type='GCD/HCF';time=25;mcq=true;
    let a=choice([12,18,24,30,36,48]),b=choice([6,8,10,12,15,20]);
    q=`GCD of ${a} and ${b}?`; ans=gcd(a,b);
    hint='Greatest Common Divisor';
  } else if (L===30) {
    type='3-STEP CHAIN';time=20;
    let a=rand(2,8),b=rand(2,8),c=rand(2,5),d=rand(1,10);
    q=`${a} Ã— ${b} + ${c} Ã— ${d} âˆ’ ${rand(1,10)} = ?`;
    let sub=rand(1,10); q=`${a} Ã— ${b} + ${c} Ã— ${d} âˆ’ ${sub} = ?`; ans=a*b+c*d-sub;
  } else if (L===31) {
    type='DECIMALS +';time=22;
    let a=randF(1,20,1),b=randF(1,20,1); q=`${a} + ${b} = ?`; ans=parseFloat((a+b).toFixed(1));
  } else if (L===32) {
    type='DECIMALS Ã—';time=22;
    let a=rand(2,9),b=randF(0.1,0.9,1); q=`${a} Ã— ${b} = ?`; ans=parseFloat((a*b).toFixed(2));
    hint='Count decimal places';
  } else if (L===33) {
    type='NEGATIVE +';time=22;mcq=true;
    let a=rand(-15,-1),b=rand(-10,15); q=`${a} + (${b}) = ?`; ans=a+b;
    hint='Watch the negatives!';
  } else if (L===34) {
    type='NEGATIVE Ã—';time=22;mcq=true;
    let a=rand(-9,-1),b=rand(2,9); q=`${a} Ã— ${b} = ?`; ans=a*b;
  } else if (L===35) {
    type='MIXED BEAST';time=18;
    let a=rand(2,6),b=rand(2,6),c=rand(10,30),d=rand(2,5);
    q=`${c} + ${a} Ã— ${b} âˆ’ ${d} = ?`; ans=c+a*b-d;

  // TIER IV: 36-55 â€” Powers, Roots, Algebra
  } else if (L===36) {
    type='SQUARES';time=20;mcq=true;
    let a=rand(2,12); q=`${a}Â² = ?`; ans=a*a;
  } else if (L===37) {
    type='CUBES';time=22;mcq=true;
    let a=rand(2,8); q=`${a}Â³ = ?`; ans=a*a*a;
  } else if (L===38) {
    type='SQRT';time=22;mcq=true;
    let a=choice([1,4,9,16,25,36,49,64,81,100,121,144]); q=`âˆš${a} = ?`; ans=Math.sqrt(a);
  } else if (L===39) {
    type='POWERS OF 2';time=18;mcq=true;
    let n=rand(1,10); q=`2^${n} = ?`; ans=Math.pow(2,n);
  } else if (L===40) {
    type='POWERS OF 3';time=22;mcq=true;
    let n=rand(1,6); q=`3^${n} = ?`; ans=Math.pow(3,n);
  } else if (L===41) {
    type='ALGEBRA';time=25;
    let a=rand(2,9),b=rand(1,20),ans_r=rand(1,15); q=`${a}x + ${b} = ${a*ans_r+b} â†’ x = ?`; ans=ans_r;
    hint='Isolate x on one side';
  } else if (L===42) {
    type='ALGEBRA';time=25;
    let a=rand(2,8),b=rand(1,10),ans_r=rand(2,15); q=`${a}x âˆ’ ${b} = ${a*ans_r-b} â†’ x = ?`; ans=ans_r;
  } else if (L===43) {
    type='ALGEBRA';time=25;
    let a=rand(2,9),ans_r=rand(5,30); q=`x/${a} = ${ans_r} â†’ x = ?`; ans=a*ans_r;
    hint='Multiply both sides by ' + a;
  } else if (L===44) {
    type='2-STEP ALGEBRA';time=28;
    let a=rand(2,5),b=rand(2,8),ans_r=rand(2,10);
    q=`${a}x + ${b} = ${a*ans_r+b} â†’ x = ?`; ans=ans_r;
  } else if (L===45) {
    type='SQUARE ROOTS';time=22;
    let a=choice([1,4,9,16,25,36,49,64,81,100]); q=`âˆš${a} + âˆš${a} = ?`; ans=2*Math.sqrt(a);
  } else if (L===46) {
    type='EXPONENTS';time=22;
    let a=rand(2,5),b=rand(2,4),c=rand(1,3); q=`${a}^${b} Ã— ${a}^${c} = ${a}^? â†’ exponent?`; ans=b+c;
    hint='Add exponents when bases match';
  } else if (L===47) {
    type='CUBE ROOT';time=25;mcq=true;
    let a=choice([1,8,27,64,125,216,343]); q=`âˆ›${a} = ?`; ans=Math.round(Math.cbrt(a));
    hint='Which number cubed gives this?';
  } else if (L===48) {
    type='POWERS EVAL';time=20;
    let a=rand(2,4),b=rand(2,3),c=rand(1,2); q=`${a}^${b} âˆ’ ${a}^${c} = ?`; ans=Math.pow(a,b)-Math.pow(a,c);
  } else if (L===49) {
    type='ALGEBRA FRAC';time=28;
    let a=rand(2,9),b=rand(1,5),ans_r=rand(3,10); q=`(x + ${b}) / ${a} = ${ans_r} â†’ x = ?`; ans=a*ans_r-b;
    hint='Multiply then subtract';
  } else if (L===50) {
    type='MIDDLE LEVEL!';time=25;mcq=true;
    let a=rand(3,9),b=rand(2,6); q=`${a}Â² + ${b}Â² = ?`; ans=a*a+b*b;
    hint='Calculate each square then add';
  } else if (L===51) {
    type='INEQUALITIES';time=22;mcq=true;
    let a=rand(2,7),b=rand(10,40),ans_r=rand(3,15);
    let rhs=a*ans_r+b; q=`${a}x + ${b} < ${rhs} â†’ x < ?`; ans=ans_r;
    hint='Solve like an equation';
  } else if (L===52) {
    type='DIFFERENCE OF SQ';time=22;mcq=true;
    let a=rand(3,9),b=rand(1,a-1); q=`${a}Â² âˆ’ ${b}Â² = ?`; ans=a*a-b*b;
  } else if (L===53) {
    type='SCIENTIFIC';time=25;mcq=true;
    let a=rand(1,9),n=rand(2,5); q=`${a} Ã— 10^${n} = ?`; ans=a*Math.pow(10,n);
    hint='Move the decimal point';
  } else if (L===54) {
    type='ALGEBRA 2VAR';time=30;
    let a=rand(2,6),b=rand(1,5),c=rand(2,8);
    let y=rand(1,5),x=rand(1,8);
    q=`If y = ${y}, find x:\n${a}x + ${b}y = ${a*x+b*y}`; ans=x;
    hint='Substitute y first';
  } else if (L===55) {
    type='POWER CHAIN';time=25;
    let b=rand(2,3),x=rand(2,4),y=rand(1,3); q=`(${b}^${x})^${y} = ${b}^? â†’ exponent?`; ans=x*y;
    hint='Multiply the exponents';

  // TIER V: 56-70 â€” Geometry, %, Word Problems
  } else if (L===56) {
    type='PERCENTAGES';time=22;mcq=true;
    let p=choice([10,20,25,50]),n=rand(20,200); q=`${p}% of ${n} = ?`; ans=n*p/100;
  } else if (L===57) {
    type='AREA RECT';time=22;
    let w=rand(4,20),h=rand(4,20); q=`Area of ${w}Ã—${h} rectangle?`; ans=w*h;
    hint='Area = length Ã— width';
  } else if (L===58) {
    type='PERIMETER';time=22;
    let w=rand(4,20),h=rand(4,20); q=`Perimeter of ${w}Ã—${h} rectangle?`; ans=2*(w+h);
    hint='Perimeter = 2(l + w)';
  } else if (L===59) {
    type='CIRCLE AREA';time=25;mcq=true;
    let r=rand(1,8); q=`Area of circle r = ${r}?\n(Use Ï€ = 3.14, round to whole)`;
    ans=Math.round(3.14*r*r);
    hint='A = Ï€ Ã— rÂ²';
  } else if (L===60) {
    type='TRIANGLE AREA';time=22;mcq=true;
    let b=rand(4,20),h=rand(4,20); q=`Area of triangle\nbase ${b}, height ${h}?`; ans=(b*h)/2;
    hint='A = Â½ Ã— base Ã— height';
  } else if (L===61) {
    type='% INCREASE';time=25;mcq=true;
    let orig=choice([50,100,200,80,120]),p=choice([10,20,25,50]);
    q=`${orig} increased by ${p}%\n= ?`; ans=orig+orig*p/100;
    hint='Add the percentage';
  } else if (L===62) {
    type='% DECREASE';time=25;mcq=true;
    let orig=choice([100,200,300,400,500]),p=choice([10,20,25,30,50]);
    q=`${orig} decreased by ${p}%\n= ?`; ans=orig-orig*p/100;
  } else if (L===63) {
    type='PROFIT/LOSS';time=25;mcq=true;
    let cost=rand(50,200)*2,sell=cost+rand(10,80);
    q=`Cost: $${cost}, Sell: $${sell}\nProfit = ?`; ans=sell-cost;
  } else if (L===64) {
    type='WORD PROBLEM';time=30;mcq=true;
    let speed=rand(30,80),time_h=rand(1,5);
    q=`A car travels ${speed}km/h\nfor ${time_h} hours.\nDistance = ?`; ans=speed*time_h;
    hint='Distance = Speed Ã— Time';
  } else if (L===65) {
    type='WORD PROBLEM';time=30;mcq=true;
    let total=rand(100,500),each=choice([4,5,8,10,20,25]);
    q=`$${total} split equally\namong ${each} people.\nEach gets $?`; ans=total/each;
  } else if (L===66) {
    type='PYTHAGORAS';time=28;mcq=true;
    let triples=[[3,4,5],[6,8,10],[5,12,13],[8,15,17],[9,40,41]];
    let t=choice(triples); q=`Right triangle:\na=${t[0]}, b=${t[1]}\nc (hypotenuse) = ?`; ans=t[2];
    hint='aÂ² + bÂ² = cÂ²';
  } else if (L===67) {
    type='ANGLES';time=22;mcq=true;
    let a=rand(20,150); q=`Supplementary angle of ${a}Â°?`; ans=180-a;
    hint='Supplementary angles sum to 180Â°';
  } else if (L===68) {
    type='ANGLES';time=22;mcq=true;
    let a=rand(10,80); q=`Complementary angle of ${a}Â°?`; ans=90-a;
    hint='Complementary angles sum to 90Â°';
  } else if (L===69) {
    type='VOLUME BOX';time=25;
    let l=rand(2,10),w=rand(2,10),h=rand(2,10); q=`Volume of ${l}Ã—${w}Ã—${h} box?`; ans=l*w*h;
    hint='V = l Ã— w Ã— h';
  } else if (L===70) {
    type='COMPOUND %';time=28;mcq=true;
    let p=choice([50,100,200,400]),r=choice([10,20,50]),t=2;
    let fv=p*Math.pow(1+r/100,t);
    q=`$${p} at ${r}%/yr for ${t}yrs\nCompound interest total?`; ans=Math.round(fv);
    hint='A = P(1 + r/100)^t';

  // TIER VI: 71-85 â€” Sequences, Primes, Logic
  } else if (L===71) {
    type='PRIMES';time=20;mcq=true;
    let n=rand(50,150); q=`Is ${n} prime?`; ans=isPrime(n)?1:0;
    hint='Check if divisible by any number';
  } else if (L===72) {
    type='NTH PRIME';time=22;mcq=true;
    let n=rand(5,15); q=`What is the ${n}th prime number?`; ans=nthPrime(n);
  } else if (L===73) {
    type='FIBONACCI';time=22;mcq=true;
    let fib=[1,1,2,3,5,8,13,21,34,55,89,144];
    let n=rand(4,10); q=`Fibonacci #${n+1}\n(1,1,2,3,5,...) = ?`; ans=fib[n];
    hint='Each term = sum of previous two';
  } else if (L===74) {
    type='ARITHMETIC SEQ';time=22;mcq=true;
    let a=rand(2,20),d=rand(2,10),n=rand(5,10);
    let nth=a+(n-1)*d; q=`Sequence: ${a}, ${a+d}, ${a+2*d},...\n${n}th term = ?`; ans=nth;
    hint='nth term = a + (nâˆ’1)d';
  } else if (L===75) {
    type='GEOMETRIC SEQ';time=25;mcq=true;
    let a=rand(2,5),r=rand(2,4),n=rand(3,6);
    q=`Sequence: ${a}, ${a*r}, ${a*r*r},...\nNext term?`; ans=a*Math.pow(r,3);
  } else if (L===76) {
    type='MODULAR ARITH';time=22;mcq=true;
    let a=rand(20,100),b=rand(3,12); q=`${a} mod ${b} = ?`; ans=a%b;
    hint='Remainder when dividing';
  } else if (L===77) {
    type='PRIME FACTORS';time=25;mcq=true;
    let n=choice([12,18,24,30,36,48,60,72]); q=`Largest prime factor\nof ${n}?`;
    let max=2; for(let i=2;i<=n;i++){if(n%i===0&&isPrime(i))max=i;} ans=max;
  } else if (L===78) {
    type='PERMUTATIONS';time=28;mcq=true;
    let n=rand(3,6),r=2; let p=1; for(let i=n;i>n-r;i--)p*=i;
    q=`P(${n},${r}) = ${n}!/(${n-r})! = ?`; ans=p;
    hint='n Ã— (nâˆ’1) Ã— ... Ã— (nâˆ’r+1)';
  } else if (L===79) {
    type='COMBINATIONS';time=28;mcq=true;
    let n=rand(4,8),r=2; let c=n*(n-1)/2;
    q=`C(${n},2) = ?`; ans=c;
    hint='n(nâˆ’1)/2';
  } else if (L===80) {
    type='LOGIC GRID';time=25;mcq=true;
    let a=rand(2,8),b=rand(2,8),c=a+b;
    q=`If A + B = ${c}\nA Ã— B = ${a*b}\nWhat is A? (smaller)`;
    ans=Math.min(a,b);
    hint='Think of factor pairs';
  } else if (L===81) {
    type='NUMBER SERIES';time=25;mcq=true;
    let a=rand(3,15),diff1=rand(2,6),diff2=rand(2,5);
    q=`${a}, ${a+diff1}, ${a+diff1+diff2}, ${a+2*diff1+diff2},...\nNext?`;
    ans=a+2*diff1+2*diff2;
    hint='Find the changing differences';
  } else if (L===82) {
    type='BASE CONVERT';time=25;mcq=true;
    let n=rand(8,31); q=`${n} in binary = ?`; ans=parseInt(n.toString(2));
    hint='Divide by 2, track remainders';
  } else if (L===83) {
    type='LOGARITHM';time=28;mcq=true;
    let b=choice([2,3,10]),n=choice([1,2,3,4]); q=`logâ‚${b}â‚(${Math.pow(b,n)}) = ?`; ans=n;
    hint='b^? = number';
  } else if (L===84) {
    type='MEAN/AVERAGE';time=22;
    let nums=[rand(10,50),rand(10,50),rand(10,50),rand(10,50),rand(10,50)];
    let mean=Math.round(nums.reduce((a,b)=>a+b,0)/nums.length);
    q=`Mean of:\n${nums.join(', ')}`; ans=mean;
    hint='Sum Ã· count';
  } else if (L===85) {
    type='PROBABILITY';time=28;mcq=true;
    let total=choice([6,8,10,12,20]);
    let fav=rand(1,total-1);
    q=`${fav} favourable out of ${total}\nProbability (%) = ?`;
    ans=Math.round(fav/total*100);
    hint='(favourable/total) Ã— 100';

  // TIER VII: 86-100 â€” Legendary
  } else if (L===86) {
    type='QUADRATIC';time=30;mcq=true;
    let p=rand(1,5),q2=rand(1,5); // (x-p)(x-q2) roots
    let b2=-(p+q2),c2=p*q2; q=`xÂ² ${b2>0?'+'+b2:b2}x ${c2>0?'+'+c2:c2} = 0\nSmaller root?`; ans=Math.min(p,q2);
    hint='Factor or use quadratic formula';
  } else if (L===87) {
    type='MULTI-STEP';time=28;
    let a=rand(2,6),b=rand(2,6),c=rand(2,8),d=rand(1,5);
    q=`${a}Â² Ã— ${b} + ${c} Ã— ${d}Â² = ?`; ans=a*a*b+c*d*d;
  } else if (L===88) {
    type='ALGEBRA EXPAND';time=28;mcq=true;
    let a=rand(2,6),b=rand(1,5); q=`(${a}x + ${b})Â² â†’ coefficient of x = ?`;
    ans=2*a*b;
    hint='(ax+b)Â² = aÂ²xÂ² + 2abx + bÂ²';
  } else if (L===89) {
    type='SUM OF SQUARES';time=25;
    let n=rand(4,8); let s=0; for(let i=1;i<=n;i++) s+=i*i;
    q=`1Â² + 2Â² + ... + ${n}Â² = ?`; ans=s;
    hint='Sum each square';
  } else if (L===90) {
    type='CHAOS CHAIN';time=22;
    let a=rand(2,5),b=rand(2,5),c=rand(2,4),d=rand(2,4),e=rand(1,5);
    q=`${a}Â³ + ${b}Â² Ã— ${c} âˆ’ ${d} Ã— ${e} = ?`; ans=Math.pow(a,3)+b*b*c-d*e;
  } else if (L===91) {
    type='DIGIT SUM';time=20;mcq=true;
    let n=rand(1000,9999); let ds=String(n).split('').reduce((s,c)=>s+parseInt(c),0);
    q=`Digit sum of ${n}?`; ans=ds;
    hint='Add each digit';
  } else if (L===92) {
    type='SPEED/DISTANCE';time=28;mcq=true;
    let d=rand(60,400),s=choice([30,40,50,60,80,100]); q=`Distance ${d}km at ${s}km/h\nTime (hrs)?`;
    ans=d/s; if(!Number.isInteger(ans)){d=s*rand(2,6);ans=d/s;q=`Distance ${d}km at ${s}km/h\nTime (hrs)?`;}
    ans=Math.round(ans);
    hint='Time = Distance Ã· Speed';
  } else if (L===93) {
    type='SIMULTANEOUS';time=35;
    let x=rand(2,8),y=rand(2,6);
    q=`x + y = ${x+y}\nx âˆ’ y = ${x-y}\nâ†’ x = ?`; ans=x;
    hint='Add equations to eliminate y';
  } else if (L===94) {
    type='CHAIN PERCENT';time=28;mcq=true;
    let v=choice([200,400,500,1000]);
    let p1=choice([10,20,25,50]),p2=choice([10,20,25,50]);
    let after=v*(1+p1/100)*(1+p2/100); q=`$${v} up ${p1}% then up ${p2}%\n= ?`; ans=Math.round(after);
  } else if (L===95) {
    type='INFINITE SERIES';time=30;mcq=true;
    let a=rand(2,8),r=choice([0.5,0.25]); let s=a/(1-r);
    q=`Sum of: ${a} + ${a*r} + ${a*r*r}...\n(infinite geometric)`; ans=s;
    hint='S = a / (1 âˆ’ r) when |r| < 1';
  } else if (L===96) {
    type='MODULAR POWER';time=30;mcq=true;
    let b=rand(2,5),e=rand(3,6),m=choice([7,9,11,13]);
    q=`${b}^${e} mod ${m} = ?`; ans=Math.pow(b,e)%m;
    hint='Calculate power then take mod';
  } else if (L===97) {
    type='TRIANGLE NUMS';time=22;mcq=true;
    let n=rand(4,12); q=`${n}th triangular number\n1+2+...+${n} = ?`; ans=n*(n+1)/2;
    hint='n(n+1)/2';
  } else if (L===98) {
    type='MIXED MEGA';time=25;
    let a=rand(3,7),b=rand(2,5),c=rand(10,20),d=rand(2,4);
    q=`âˆš${a*a} Ã— ${b}Â² + ${c} Ã· ${d} âˆ’ ${rand(2,8)} = ?`;
    let sub=rand(2,8); q=`âˆš${a*a} Ã— ${b}Â² + ${c} Ã· ${d} âˆ’ ${sub} = ?`;
    ans=a*b*b+c/d-sub; if(!Number.isInteger(ans)){c=d*rand(3,8);q=`âˆš${a*a} Ã— ${b}Â² + ${c} Ã· ${d} âˆ’ ${sub} = ?`;ans=a*b*b+c/d-sub;}
    ans=Math.round(ans*100)/100;
  } else if (L===99) {
    type='SUPER ALGEBRA';time=35;
    let a=rand(2,5),b=rand(1,4),x=rand(3,10);
    q=`${a}xÂ² = ${a*x*x}\nSolve for x (positive root) = ?`; ans=x;
    hint='Divide then square root';
  } else if (L===100) {
    type='ğŸ”¥ FINAL BOSS';time=35;
    let a=rand(2,4),b=rand(2,4),x=rand(2,6),y=rand(2,6);
    q=`${a}x + ${b}y = ${a*x+b*y}\n${a}x âˆ’ ${b}y = ${a*x-b*y}\nâ†’ x + y = ?`; ans=x+y;
    hint='Solve the system, add the roots!';
    time=40;
  }

  return { question:q, answer:ans, hint, type, time, mcq };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GAME STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let state = {
  level: 1, questionIdx: 0, totalQ: 10,
  score: 0, lives: 3, streak: 0, bestStreak: 0,
  correct: 0, wrong: 0,
  curQ: null, timerMax: 600, timerLeft: 600,
  timerInt: null, running: false
};

const ACCENT_COLORS = {
  1:'#39ff14', 11:'#00f5ff', 21:'#ffbe0b', 36:'#ff8c00', 56:'#ff006e', 71:'#bf5fff', 86:'#ffffff'
};
function getAccent(lvl) {
  let color = '#39ff14';
  for (const [l, c] of Object.entries(ACCENT_COLORS)) {
    if (lvl >= parseInt(l)) color = c;
  }
  return color;
}

function startLevel(lvl) {
  state.level = lvl;
  state.questionIdx = 0;
  state.totalQ = lvl >= 86 ? 15 : lvl >= 71 ? 12 : 10;
  state.score = 0;
  state.lives = lvl >= 86 ? 2 : 3;
  state.streak = 0;
  state.bestStreak = 0;
  state.correct = 0;
  state.wrong = 0;
  state.running = true;

  const accent = getAccent(lvl);
  document.documentElement.style.setProperty('--accent', accent);
  document.getElementById('timerCircle').style.stroke = accent;

  document.getElementById('levelSelectScreen').style.display = 'none';
  const gs = document.getElementById('gameScreen');
  gs.style.display = 'flex';

  document.getElementById('levelBadge').textContent = `LVL ${lvl}`;
  updateHUD();
  nextQuestion();
}

function updateHUD() {
  document.getElementById('scoreVal').textContent = state.score;
  const hearts = 'â™¥'.repeat(state.lives) + 'â™¡'.repeat(Math.max(0,3-state.lives));
  document.getElementById('livesVal').textContent = hearts;
  document.getElementById('questionNum').textContent = `${state.questionIdx}/${state.totalQ}`;
  const pct = Math.round(state.questionIdx / state.totalQ * 100);
  document.getElementById('progressBar').style.width = pct + '%';
  document.getElementById('progressText').textContent = pct + '%';
  const sd = document.getElementById('streakDisplay');
  sd.textContent = `STREAK: ${state.streak}${state.streak>=5?' ğŸ”¥':''}`;
  sd.className = 'streak-display' + (state.streak >= 5 ? ' hot' : '');
}

function nextQuestion() {
  if (state.questionIdx >= state.totalQ) { levelComplete(); return; }
  clearInterval(state.timerInt);

  state.curQ = generateQuestion(state.level);
  const q = state.curQ;

  document.getElementById('questionTypeTag').textContent = q.type;
  document.getElementById('questionText').textContent = q.question;
  document.getElementById('questionHint').textContent = q.hint || '';
  document.getElementById('feedback').textContent = '';
  document.getElementById('feedback').className = 'feedback';

  const useMCQ = q.mcq;
  document.getElementById('optionsGrid').style.display = useMCQ ? 'grid' : 'none';
  document.getElementById('inputRow').style.display = useMCQ ? 'none' : 'flex';

  if (useMCQ) {
    buildOptions(q.answer);
  } else {
    const inp = document.getElementById('answerInput');
    inp.value = '';
    inp.className = 'answer-input';
    inp.disabled = false;
    inp.focus();
  }

  startTimer(q.time);
}

function buildOptions(correctAns) {
  const grid = document.getElementById('optionsGrid');
  grid.innerHTML = '';
  const correct = correctAns;

  // Generate 3 wrong answers
  let wrongs = new Set();
  while (wrongs.size < 3) {
    let w;
    if (typeof correct === 'string') {
      // fraction answers
      const parts = correct.split('/');
      const n = parseInt(parts[0]) + rand(-3,3);
      const d = parseInt(parts[1]) + rand(-2,2);
      if (d > 0 && n > 0 && `${n}/${d}` !== correct) w = `${n}/${d}`;
    } else if (Number.isInteger(correct)) {
      const off = rand(1, Math.max(3, Math.abs(correct/3)|0 || 5));
      w = correct + choice([-1,1]) * off;
    } else {
      const off = randF(0.1, Math.abs(correct*0.3)+0.1);
      w = parseFloat((correct + choice([-1,1])*off).toFixed(2));
    }
    if (w !== undefined && w !== correct && !wrongs.has(w)) wrongs.add(w);
  }

  const options = shuffle([correct, ...wrongs]);
  options.forEach(opt => {
    const btn = document.createElement('button');
    btn.className = 'option-btn';
    btn.textContent = opt;
    btn.onclick = () => checkMCQ(btn, opt, correct);
    grid.appendChild(btn);
  });
}

function shuffle(arr) {
  for(let i=arr.length-1;i>0;i--){const j=rand(0,i);[arr[i],arr[j]]=[arr[j],arr[i]];}
  return arr;
}

function checkMCQ(btn, selected, correct) {
  clearInterval(state.timerInt);
  document.querySelectorAll('.option-btn').forEach(b => b.disabled = true);

  const isCorrect = String(selected) === String(correct);
  btn.classList.add(isCorrect ? 'correct' : 'wrong');
  if (!isCorrect) {
    document.querySelectorAll('.option-btn').forEach(b => {
      if (String(b.textContent) === String(correct)) b.classList.add('correct');
    });
  }
  handleResult(isCorrect);
}

function checkInput() {
  const inp = document.getElementById('answerInput');
  const raw = inp.value.trim();
  if (!raw) return;

  const correct = state.curQ.answer;
  let isCorrect = false;

  if (typeof correct === 'string') {
    isCorrect = raw === correct;
  } else {
    const num = parseFloat(raw);
    isCorrect = !isNaN(num) && Math.abs(num - correct) < 0.01;
  }

  inp.disabled = true;
  clearInterval(state.timerInt);

  if (isCorrect) {
    inp.classList.add('correct-flash');
  } else {
    inp.classList.add('shake', 'wrong-flash');
  }
  handleResult(isCorrect);
}

function handleResult(isCorrect) {
  state.questionIdx++;
  const fb = document.getElementById('feedback');

  if (isCorrect) {
    state.correct++;
    state.streak++;
    if (state.streak > state.bestStreak) state.bestStreak = state.streak;
    const bonus = state.streak >= 5 ? 50 : state.streak >= 3 ? 25 : 0;
    const timeBonus = Math.round(state.timerLeft * 2);
    const pts = 100 + bonus + timeBonus;
    state.score += pts;
    fb.textContent = `âœ“ CORRECT! +${pts}${bonus>0?' (STREAK BONUS!)':''}`;
    fb.className = 'feedback correct-fb';
    spawnParticles();
  } else {
    state.wrong++;
    state.streak = 0;
    state.lives--;
    fb.textContent = `âœ— WRONG! Answer: ${state.curQ.answer}`;
    fb.className = 'feedback wrong-fb';
    if (state.lives <= 0) {
      setTimeout(gameOver, 1200); updateHUD(); return;
    }
  }

  updateHUD();
  setTimeout(nextQuestion, 1200);
}

function startTimer(secs) {
  state.timerMax = secs;
  state.timerLeft = secs;
  const circle = document.getElementById('timerCircle');
  const C = 238.76;

  function tick() {
    state.timerLeft -= 0.1;
    const t = Math.max(0, state.timerLeft);
    document.getElementById('timerNum').textContent = Math.ceil(t);
    circle.style.strokeDashoffset = C * (1 - t/state.timerMax);

    if (t <= 5) circle.style.stroke = '#ff006e';
    else if (t <= 10) circle.style.stroke = '#ffbe0b';
    else circle.style.stroke = getAccent(state.level);

    if (state.timerLeft <= 0) {
      clearInterval(state.timerInt);
      // Time's up â€” count as wrong
      const fb = document.getElementById('feedback');
      fb.textContent = `â± TIME UP! Answer: ${state.curQ.answer}`;
      fb.className = 'feedback wrong-fb';
      state.wrong++; state.streak = 0; state.lives--;
      state.questionIdx++;
      document.getElementById('answerInput').disabled = true;
      document.querySelectorAll('.option-btn').forEach(b => b.disabled = true);
      updateHUD();
      if (state.lives <= 0) { setTimeout(gameOver, 1200); return; }
      setTimeout(nextQuestion, 1200);
    }
  }

  clearInterval(state.timerInt);
  state.timerInt = setInterval(tick, 100);
}

function spawnParticles() {
  const emojis = ['âœ¨','ğŸ’¥','âš¡','ğŸŒŸ','ğŸ’«','ğŸ”¥'];
  for (let i=0;i<6;i++) {
    const p = document.createElement('div');
    p.className = 'particle';
    p.textContent = choice(emojis);
    p.style.setProperty('--dx', (rand(-150,150))+'px');
    p.style.setProperty('--dy', (rand(-150,150))+'px');
    p.style.animationDuration = (rand(4,8)/10)+'s';
    document.body.appendChild(p);
    setTimeout(()=>p.remove(), 900);
  }
}

function levelComplete() {
  clearInterval(state.timerInt);
  state.running = false;

  completed[state.level] = true;
  localStorage.setItem('mathBlitzCompleted', JSON.stringify(completed));

  const acc = Math.round(state.correct/(state.correct+state.wrong)*100);
  const stars = acc >= 90 ? 'â­â­â­' : acc >= 70 ? 'â­â­' : 'â­';

  document.getElementById('completeTitle').textContent = state.level === 100 ? 'ğŸ† ALL 100 CLEARED! ğŸ†' : 'LEVEL CLEAR!';
  document.getElementById('completeMsg').textContent = acc >= 90 ? 'Perfect run! Incredible!' : acc >= 70 ? 'Great work!' : 'Level complete!';
  document.getElementById('completeStars').textContent = stars;
  document.getElementById('cScore').textContent = state.score;
  document.getElementById('cAccuracy').textContent = acc + '%';
  document.getElementById('cBestStreak').textContent = state.bestStreak;

  const nextBtn = document.getElementById('nextLevelBtn');
  if (state.level >= 100) { nextBtn.textContent = 'ğŸ† CHAMPION!'; nextBtn.disabled = true; }
  else { nextBtn.textContent = `LEVEL ${state.level+1} â†’`; nextBtn.disabled = false; }

  document.getElementById('levelComplete').style.display = 'flex';
}

function gameOver() {
  clearInterval(state.timerInt);
  state.running = false;
  const acc = state.correct+state.wrong > 0 ? Math.round(state.correct/(state.correct+state.wrong)*100) : 0;
  document.getElementById('goScore').textContent = state.score;
  document.getElementById('goAccuracy').textContent = acc + '%';
  document.getElementById('goStreak').textContent = state.bestStreak;
  document.getElementById('gameOver').style.display = 'flex';
}

function nextLevel() {
  document.getElementById('levelComplete').style.display = 'none';
  startLevel(state.level + 1);
}

function retryLevel() {
  document.getElementById('gameOver').style.display = 'none';
  startLevel(state.level);
}

function exitToMenu() {
  clearInterval(state.timerInt);
  document.getElementById('levelComplete').style.display = 'none';
  document.getElementById('gameOver').style.display = 'none';
  document.getElementById('gameScreen').style.display = 'none';
  document.getElementById('levelSelectScreen').style.display = 'block';
  // Rebuild to update completions
  document.querySelectorAll('.lvl-btn').forEach(btn => {
    const lvl = parseInt(btn.textContent);
    if (completed[lvl]) btn.classList.add('completed');
  });
}

// Input handlers
document.getElementById('submitBtn').addEventListener('click', checkInput);
document.getElementById('answerInput').addEventListener('keydown', e => {
  if (e.key === 'Enter') checkInput();
});

// Build the level select grid
buildLevelSelect();
</script>
</body>
</html>